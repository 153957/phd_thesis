\chapter{Software}
\label{ch:software}

\section{\github}

Our code has transitioned from bazaar to \git, a different distributed
version control system. This made it possible to use the service \github
to host our projects. \github provides a web-interface to manage
projects, keep track of issues, and manage pull requests.

When we were using Bazaar our repositories were hosted on a Nikhef
server, this made it difficult for others to participate and contribute.
On \github the software has been open sourced and can be downloaded with
a single click, on any system.

\github also provides webpage hosting of static pages for repositories,
called \github Pages. We use it to host software documentation and
compiled version of the teaching materials, for which the sources are
also on \github.


\section{Structure}

Since the code can now be easily accessed by anyone we cleaned up the
code to be more consistent and conform to a coding style. For \python we
try to conform to Python Enhancement Proposal (PEP) 8 - Style Guide for
Python Code.


\section{Repositories}

This is a list of the different repositories.

\begin{verbatim}
Data analysis/presentation
sapphire - SAPPHiRE, a framework for HiSPARC
pysparc - HiSPARC DAQ implemented in Python
publicdb - The HiSPARC Public Database
jsparc - Javascript library and coincidences analysis
gz-sim - Gerasimova-Zatsepin effect simulation
framework - (deprecated) HiSPARC tools
correlation - Data correlation analysis
interaction-position - Calculate possible interaction positions from detection timestamps
practica - project by Niek?
data-quality - Data quality checks
topaz PRIVATE - Scripts for small analyses with HiSPARC data
tijdtest PRIVATE - Analysis for the time calibration of HiSPARC boxes

Detection
datastore - Data storage solution
station-software - Software running on HiSPARC station pc's
hisparcdaq - DAQ software
weather - Weather DAQ software
lightning - Lightning DAQ software
vhdl - FPGA source
muonlab - Muon experiments

Teaching Material
infopakket - Teaching materials
routenet - High-school course material

Papers
2014_experiment PRIVATE - Paper about the HiSPARC experimental setup
2014_direction PRIVATE - Paper about HiSPARC direction reconstruction chain

Webpages
hisparc.github.io - HiSPARC GitHub Pages
logo - HiSPARC logo's
servers - Contains details on how the HiSPARC servers are setup
maintenance - HiSPARC station maintenance information
\end{verbatim}

Add some flowcharts


\section{\hisparc Public Database}

\subsection{\api}

In order to make interactive applications (see \jsparc) we needed to make
access to all kinds of data easy. To facilitate this an \api has been
added to the Public Database. The \api consists of a number of urls that
return data in the form of a JSON (Javscript Object Notation). For
example a list of \hisparc stations can be retrieved via
\url{http://data.hisparc.nl/api/stations/}, the result is:

\begin{verbatim}
[
    {"name": "St. Nicolaaslyceum",
     "number": 2},
    {"name": "Het Amsterdams Lyceum",
     "number": 3},
    {"name": "Chr. Sch. Gem. Buitenveldert",
     "number": 5},
    {"name": "Bern. Nieuwetijt Coll. (Damstede)",
     "number": 6},
    {"name": "Joke Smit College (ROC)",
     "number": 7},
    ...
    {"name": "Karlsruher Institut f√ºr Technologie",
     "number": 70001}
]
\end{verbatim}

A list of all possible urls can be found at \url{http://data.hisparc.nl/api/}.

Functions have been added to both \sapphire and \jsparc to access the
\api. These take care of constructing the urls and converting the json to a
sensible format for the programming language language.


\subsection{Event Summary Database}

Derived database with certain analyses applied, as explained later. Also
coincidences already found, next; automated reconstructions


\section{\sapphire}


\subsection{\pypi}

\sapphire has been made available for easy installation via the Python
Package Index (\pypi).


\subsection{Clusters}

Using the \api \sapphire has access to the \gps coordinates of all
stations. For stations that have submitted their detector positions,
those are available as well. This makes it easy to setup a cluster with
any selection of \hisparc stations. This can be used for simulations.
Imaginary stations can be added to plan future station locations.

\subsection{\corsika}

Reading \corsika output, convert to \hdf and use for simulations.


\subsection{Refactored simulations}

The simulation section of \sapphire has been completely rewritten
working together with dr. David Fokkema and Hans Montanus. Works with
\corsika data, more consistent output that can eb analysed the same way
as real \hisparc data (except that the input is also known).


\subsection{Data quality}

\todo{Write code to determine data quality.}


\section{Code testing}

Tests have been written to ensure that programming code does what is
expected, even when it is modified later. Code tests can be very
specific and check precise output given some inputs, check how often
another function is called, and ensure that the correct errors are
thrown given invalid input. Less specific tests that merely check the
type of the output or validate the style are sometimes used.

These tests can be run locally while developing code. However,
developers still might forget to run tests or do not want to spend time
testing. To ensure that new code is always tested the \sapphire and
\jsparc repositories have the Travis CI service added. After new commits
are pushed to those repository Travis CI starts a Virtual Machine that
will download the repository and any requirements we have defined and
run the tests.


\subsection{Coverage}

Having some tests does not guarantee that every bit of code is tested.
To check which parts of the code are tests Coveralls have been added.
While Travis CI runs tests is keeps track of which lines of code in
\sapphire are run. At the end of the tests a report is sent to Coveralls
that shows overviews of which lines have been tested and which have not.


\subsection{Vagrant}

The Public Database is more complex than \sapphire and \jsparc. It
requires the Django package, a database and raw data to be fully tested.
These tests can be very time consuming. When developing code for the
Public Database, it is best to test it in en environment similar to the
live server. To accomplish this we use a virtual machine that is
provisioned by scripts to install the required packages and setup some
configurations. These scripts for provisioning a test machine can also
be used to setup the live server, this ensures that the test and live
server are almost identical.

\todo{Testing publicdb}
