\section{Station design}

\subsection{HiSPARC electronics}

The \hisparc hardware (versions II and III) combine \pmt control, signal
readout/daq, triggering logic, and the \gps receiver into one unit. The
unit can be controlled and readout from a PC connected via USB
\cite{messages}. The original version of the \hisparc hardware did not
include the \daq and \gps receiver, those were separate modules and it
could not be controlled via USB. Since that original version is no
longer used by any station in the network it is ignored in the following
discussion.


\subsubsection{\pmt control}

The \pmts are connected to the \hisparc electronics which provide it with power. The control voltage can be chosen between \SIrange{.3}{1.5}{\volt} which the \pmt will amplify to a high voltage of \SIrange{300}{1500}{\volt}. As feedback the current of the \pmt can be readout. Deviations from the expected values can indicate failing \pmts, i.e. a higher current. Nominal high voltage operating range for \pmts in \hisparc is \SI{870\pm120}{\volt}, which matches the expected range from the \pmt specifications.


\subsubsection{Signal readout}

Readout electronics. Two channels, each with two ADCs which readout a
signal up to \SI{-2}{\volt}. And return a 12-bit value (4096 ADCcounts
range). Each ADC is sampled at 200 MHz, using two ADCs per channel gives
400 Mhz (2.5 ns) per channel. Nikhef designed. Some (derivatives) used
in other experiments.


\subsubsection{Triggering logic}

Multiple detectors connected to \hisparc electronics makes a station. Multiple detectors are required to determine the presence of an air shower instead of single muons (small showers) or background radiations (Hz?). The \hisparc electronics continually readout the signal and compare the \adc values to two thresholds; the low and high threshold. These thresholds can be set for each channel individually. Usually they are set equally for all channels in a station, i.e. at \SI{-30}{\milli\volt} and \SI{-70}{\milli\volt} [mention corresponding ADC counts]. When a channel crosses a threshold a counter is started for that channel and threshold. This counter will run for the length of the trigger window. After which it can be activated again if a signal again crosses the threshold (from below to above the threshold).

Every clock the FPGA determines if the required thresholds for a trigger are active. If trigger conditions are met an event is created.

A station with 2 detectors only has a Master box which has two input channels. In such a station there are 4 threshold counters, two per channel, to keep track of. The electronics can be configured to trigger on a combination of low and high signals. For example '1 high AND 1 low'. Because a high signal implies also a low signal this means one channel high AND another channel low, or in the logic of the FPGA: one high and two low. These trigger threshold requirements can not be set per channel (clever threshold settings?).

For a Master-Slave combination the possible trigger combinations are x low and y high where x >= y or x low or y high where xand y in 0, 1, 2, 3, 4 . Additionally an external trigger is available to independetly trigger the electronics.

\subsubsection{Timing}

Pulse per second is received, synchronization error.
PPS/Events
GPS receiver module \cite{trimble}
The externel trigger has an offset of \SI{125}{\ns} relative to a normal trigger.


\subsubsection{Master and Slave}
\label{sub:masterslave}

Master and Slave contain the same firmware, each should be configured
with the same settings. The boxes are connected with two
\SI{0.3}{\meter} UTP cables that facilitate the communication between
the two units. The Master sends its PPS data to the Slave, this allows
the Slave to keep track of its own CTP (clock ticks between PPS) values.
Both units send One Second Messages to the PC, each with their own CTP
values. All \adc values are checked against the thresholds at each clock
tick (\SI{200}{\mega\hertz}). Each channel has two ADCs, one checks the
signal on the positive flank of the clock, the other on the negative.
The results of the comparison to the thresholds is also communicated
between the Master and Slave, because they need to know what the
conditions in all four channels is to determine if a trigger occurred.
When a unit determines a trigger takes place it will latch the number of
clock ticks since the last CTP, this is called the CTD. The event will
also contain the timestamp of the last PPS. Then each unit will send
their own measured data message to the pc. The PC will need to figure
out which Master and Slave events belong together. The CTP value from
the one second message at the end of the second in which the event
occurred is used to determine at what fraction of the second the
event occurred. This timestamp is further corrected for more accuracy, the method of determining the \gps timestamp is described in section Cluster performance - Timing.


\subsection{Layout of the detectors}

Multiple detectors are used to exclude single muons from triggering the station. The layout of a  typical 4-detector station is shown in \cref{fig:4_detector_station}. The detectors are separated by \SI{10}{\meter} to exclude the smallest showers. Given the location of the station is on the roofs of buildings the size of typical roofs also limits the possible size of the stations. The distance between detectors also affects the resolution for reconstructing the direction of air showers. The possible directions for three detectors in an equilateral triangle with \SI{10}{\meter} sides and a timing resolution of \SI{2.5}{\ns} is shown in \cref{fig:discrete_directions}. Using the inner detector with two outer detectors reduces the direction resolution, having only 1/3rd the possible directions. In some cases (space allowing) the decision has been made to move the inner detector outside the triangle to for a new equilateral triangle with one of the sides. More reconstructable events?

\begin{figure}
    \centering
    \input{plots/hisparc-experiment/4_detector_station}
    \caption{\captitle{Standard 4-detector station layout.} The colored
             rectangles represent the scintillator detectors.}
    \label{fig:4_detector_station}
\end{figure}

\begin{figure}
    \centering
    \input{plots/hisparc-experiment/discrete_directions}
    \caption{\captitle{Discrete direction reconstructions.} The possible
             direction reconstructions for a station with 3 detectors in
             a \SI{10}{\meter} equilateral triangle. The discrete
             solutions are due to the \SI{2.5}{\ns} sampling
             rate of the \adcs.}
    \label{fig:discrete_directions}
\end{figure}

The layout of each station is not always precisely according to the suggested layout. Not all roofs provide the required space. It is not a problem if the layout deviates from the suggested ones, as long as we do know where the detectors are. In order to get the absolute position of the detectors their positions are measured relative to the \gps, whose position is know (see next chapter?). For this a distance measuring device (rolmaat) and a compass are required. The position of each detector is recorded relative to the \gps, its distance and the angle between (True?) North and the detector. Additionally the rotation of the detector itsself around its center can be recorded, though this is less important. The coordinate system is also described in [ref appendix coordinates compass]. If the location of detectors relative to the \gps is changed the new layout can be recorded with the timestamp of when it changed. The data analysis takes these changes into account to use the correct layout when reconstructing events. For students a document has been created which outlines the steps for measuring their detector positions and how they can submit them to the Public Database. Information about the position of detectors in 2-detector stations is also important, though (full) direction reconstruction is not possible with only two detectors it can define a plane where the shower should come from (reference Niek).
